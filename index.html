"""
AYA AI TRAVEL STUDIO - FULL SIMULATION VERSION
Amadeus + Stripe + Email + WhatsApp –ë–∏–ª—è–Ω–∞
LIVE: https://ai-travel-pro.streamlit.app/
"""

import streamlit as st
import pandas as pd
from datetime import datetime
import base64
import urllib.parse
from fpdf import FPDF

# AYA BRANDING [file:67]
AYA_BLUE = "#00b4db"
AYA_DARK = "#0083b0"
CONTACT_NAME = "–ë–∏–ª—è–Ω–∞ –ë–∏–ª–±–∏–ª–æ–≤–∞ –¢–µ—Ä–∑–∏–µ–≤–∞"
WHATSAPP_PHONE = "359894842882"
EMAIL = "Aya.smart.store@gmail.com"

st.set_page_config(page_title="AYA AI Travel Studio", page_icon="‚úàÔ∏è", layout="wide")

# FIXED CSS
st.markdown(f"""
<style>
[data-testid="stAppViewContainer"] {{
    background: linear-gradient(135deg, {AYA_BLUE} 0%, {AYA_DARK} 100%);
    color: white;
}}
.main .block-container {{ padding-top: 2rem; }}
.aya-card {{
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255,255,255,0.2);
    margin: 1rem 0;
}}
.stButton > button {{
    background: white !important;
    color: {AYA_DARK} !important;
    border-radius: 25px !important;
    font-weight: bold !important;
    border: none !important;
    padding: 1rem 2rem !important;
}}
h1 {{ color: white !important; font-size: 3.5rem !important; text-align: center; }}
h2 {{ color: #f0f8ff !important; text-align: center; }}
</style>
""", unsafe_allow_html=True)

# Flight Simulation (Real SerpAPI ready)
@st.cache_data
def find_flights(origin, dest, outbound, adults):
    flights = [
        {"airline": "Ryanair", "time": f"{origin} 07:00 ‚Üí {dest} 09:30", "price": 72, "link": "https://ryanair.com"},
        {"airline": "Wizz Air", "time": f"{origin} 06:15 ‚Üí {dest} 08:45", "price": 89, "link": "https://wizzair.com"},
    ]
    return pd.DataFrame(flights)

# Hotel Simulation (Real SerpAPI ready)
@st.cache_data
def find_hotels(dest, adults):
    hotels = [
        {"name": f"{dest} Pulitzer ‚≠ê4.8", "price": 285, "link": "https://pulitzeramsterdam.com"},
        {"name": f"{dest} Conservatorium ‚≠ê4.9", "price": 412, "link": "https://conservatoriumhotel.com"},
    ]
    return pd.DataFrame(hotels)

# AYA TravelBook PDF
def create_aya_pdf(name, dest, total):
    pdf = FPDF()
    pdf.add_page()
    pdf.set_fill_color(0, 180, 219)
    pdf.rect(0, 0, 210, 40, 'F')
    pdf.set_font('Arial', 'B', 20)
    pdf.set_text_color(255, 255, 255)
    pdf.cell(0, 15, 'AYA AI TRAVEL BOOK V4', 0, 1, 'C')
    
    pdf.ln(20)
    pdf.set_font('Arial', 'B', 16)
    pdf.set_text_color(0, 0, 0)
    pdf.cell(0, 10, f'–î–ï–°–¢–ò–ù–ê–¶–ò–Ø: {dest}', 0, 1, 'C')
    pdf.cell(0, 10, f'–û–ë–©–ê –¶–ï–ù–ê: ‚Ç¨{total}', 0, 1, 'C')
    pdf.cell(0, 10, f'–ö–õ–ò–ï–ù–¢: {name}', 0, 1, 'C')
    
    pdf.ln(20)
    pdf.set_font('Arial', '', 12)
    pdf.cell(0, 10, f'–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç: {CONTACT_NAME}', 0, 1, 'C')
    pdf.cell(0, 10, f'WhatsApp: +359 894 84 28 82 | {EMAIL}', 0, 1, 'C')
    
    return pdf.output(dest='S').encode('latin-1')

# MAIN APP
st.title("ü§ñ –ü–ï–¢–Ø")
st.markdown("### AYA AI Travel Studio üíé")

with st.container():
    st.markdown('<div class="aya-card">', unsafe_allow_html=True)
    
    # INPUT FORM
    col1, col2, col3, col4 = st.columns(4)
    with col1:
        origin = st.selectbox("‚úàÔ∏è –û—Ç", ["SOF", "VAR", "PLV"], key="origin")
    with col2:
        dest = st.selectbox("üìç –î–æ", ["AMS", "PAR", "LON", "ROM"], key="dest")
    with col3:
        outbound = st.date_input("üìÖ –ò–∑–ª–∏—Ç–∞–Ω–µ", datetime(2026, 1, 5), key="out")
        return_date = st.date_input("üìÖ –í—Ä—ä—â–∞–Ω–µ", datetime(2026, 1, 10), key="ret")
    with col4:
        adults = st.slider("üë• –í—ä–∑—Ä–∞—Å—Ç–Ω–∏", 1, 4, 2, key="adults")
        client_name = st.text_input("üë§ –ò–º–µ", key="name")
    
    if st.button("üöÄ –ù–ê–ú–ò–†–ò –ü–™–¢–£–í–ê–ù–ï", use_container_width=True):
        with st.spinner("üîç –ú–ò–Ø + –ï–í–ê –∞–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç..."):
            # Flights + Hotels
            flights = find_flights(origin, dest, outbound, adults)
            hotels = find_hotels(dest, adults)
            
            # Total Price
            nights = (return_date - outbound).days
            total = (flights['price'].sum() * adults) + (hotels['price'].iloc[0] * nights * adults)
            
            # DISPLAY RESULTS
            st.markdown("### ‚úàÔ∏è –ü–æ–ª–µ—Ç–∏ (Amadeus API)")
            for _, f in flights.iterrows():
                st.success(f"**{f['airline']}** {f['time']} | **‚Ç¨{f['price']}**")
                st.markdown(f"[üîó –ö–Ω–∏–∂–∏]({f['link']})")
            
            st.markdown("### üè® –•–æ—Ç–µ–ª–∏ (Google Hotels)")
            for _, h in hotels.iterrows():
                st.success(f"**{h['name']}** ‚≠ê4.8 | **‚Ç¨{h['price']}/–Ω–æ—â**")
                st.markdown(f"[üèõÔ∏è –û—Ñ–∏—Ü–∏–∞–ª–µ–Ω —Å–∞–π—Ç]({h['link']})")
            
            st.markdown(f"### üí∞ **–û–±—â–∞ —Ü–µ–Ω–∞: ‚Ç¨{total:.0f}**")
            st.markdown(f"*‚ú® {nights} –Ω–æ—â—É–≤–∫–∏ + –ø–æ–ª–µ—Ç–∏ + —Ç–∞–∫—Å–∏*")
            
            # PAYMENT + EMAIL SIMULATION
            col_pay, col_actions = st.columns([2, 1])
            
            with col_pay:
                if st.button("üí≥ –ü–õ–ê–¢–ò –°–ï–ô–ß–ê–°", use_container_width=True):
                    with st.spinner("ü§ñ LangGraph + SendGrid –∏–∑–ø—Ä–∞—â–∞–Ω–µ..."):
                        
                        # SIMULATION EMAIL TO –ë–ò–õ–Ø–ù–ê
                        email_content = f"""
üîî –ù–û–í –ö–õ–ò–ï–ù–¢! –ü–õ–ê–¢–ò ‚Ç¨{total:.0f}!

üë§ {client_name or 'Test User'}
‚úàÔ∏è {origin} ‚Üí {dest} | {adults} –≤—ä–∑—Ä–∞—Å—Ç–Ω–∏
üìÖ {outbound.strftime('%d.%m.%Y')} - {return_date.strftime('%d.%m.%Y')}

üí∞ Ryanair ‚Ç¨72 + Pulitzer ‚Ç¨285 x{nights} = ‚Ç¨{total:.0f}
‚úÖ Stripe Checkout —É—Å–ø–µ—à–µ–Ω!

üìã –ó–ê–ö–ê–ó–ê–ù–û:
‚Ä¢ –ü–æ–ª–µ—Ç–∏: Ryanair/Wizz Air
‚Ä¢ –•–æ—Ç–µ–ª: Pulitzer Amsterdam ‚≠ê4.8
‚Ä¢ –¢–∞–∫—Å–∏ + —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∏

‚úÖ –ë–∏–ª—è–Ω–∞ - Manual —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è!
üìû +359 894 84 28 82
                        """
                        
                        st.success("‚úÖ **–†–ï–ó–ï–†–í–ê–¶–ò–Ø–¢–ê –ï –ò–ó–ü–†–ê–¢–ï–ù–ê!** üéâ")
                        st.balloons()
                        
                        st.markdown("### üìß **–ë–∏–ª—è–Ω–∞ –ø–æ–ª—É—á–∏ —Ç–æ–∑–∏ –∏–º–µ–π–ª:**")
                        st.code(email_content, language="markdown")
                        
                        # WhatsApp –ë–∏–ª—è–Ω–∞
                        wa_msg = urllib.parse.quote(f"üîî –ù–û–í –ö–õ–ò–ï–ù–¢! {client_name} ‚Ç¨{total} {origin}‚Üí{dest}")
                        st.markdown(f"""
                        <a href="https://wa.me/{WHATSAPP_PHONE}?text={wa_msg}" target="_blank">
                            <button style="width:100%; background:#25D366; color:white;">üì≤ –ò–∑–≤–µ—Å—Ç–∏ –ë–∏–ª—è–Ω–∞</button>
                        </a>
                        """, unsafe_allow_html=True)
            
            with col_actions:
                # PDF Download
                if client_name:
                    pdf_data = create_aya_pdf(client_name, f"{origin}‚Üí{dest}", total)
                    b64_pdf = base64.b64encode(pdf_data).decode()
                    st.markdown(f'''
                    <a href="data:application/pdf;base64,{b64_pdf}" download="AYA_{dest}_{int(total)}.pdf">
                        <button style="width:100%; background:#d4af37; color:black;">üì• TravelBook PDF</button>
                    </a>
                    ''', unsafe_allow_html=True)
    
    st.markdown('</div>', unsafe_allow_html=True)

# Footer
st.markdown(f"""
<div style='text-align: center; padding: 2rem; color: rgba(255,255,255,0.8);'>
    <p>‚ú® AYA AI Travel Studio | {CONTACT_NAME} | +359 894 84 28 82 | <a href="https://wa.me/{WHATSAPP_PHONE}" style="color:#25D366;">WhatsApp</a></p>
</div>
""", unsafe_allow_html=True)
