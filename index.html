"""
AYA AI TRAVEL STUDIO - PRODUCTION VERSION
Amadeus API + Google Hotels + Stripe Payments + WhatsApp –ë–∏–ª—è–Ω–∞
LIVE: https://ai-travel-pro.streamlit.app/
"""

import os
import streamlit as st
import pandas as pd
from datetime import datetime, timedelta
import base64
import urllib.parse
from fpdf import FPDF

# AYA MASTER SYSTEM BRANDING [file:67]
AYA_BLUE = "#00b4db"
AYA_DARK = "#0083b0"
CONTACT_NAME = "–ë–∏–ª—è–Ω–∞ –ë–∏–ª–±–∏–ª–æ–≤–∞ –¢–µ—Ä–∑–∏–µ–≤–∞"
WHATSAPP_PHONE = "359894842882"
EMAIL = "Aya.smart.store@gmail.com"

# CONFIG
st.set_page_config(
    page_title="AYA AI Travel Studio üíé", 
    page_icon="‚úàÔ∏è",
    layout="wide"
)

# AYA PREMIUM STYLE [file:67]
def apply_aya_style():
    st.markdown(f"""
    <style>
    .stApp {{
        background: linear-gradient(135deg, {AYA_BLUE} 0%, {AYA_DARK} 100%);
        color: white;
    }}
    .aya-card {{
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        padding: 2rem;
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }}
    .stButton > button {{
        background: linear-gradient(45deg, white, #f0f8ff);
        color: {AYA_DARK};
        border-radius: 25px;
        font-weight: bold;
        font-size: 1.1rem;
        border: none;
        padding: 1rem 2rem;
        transition: all 0.3s;
    }}
    .stButton > button:hover {{
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }}
    </style>
    """, unsafe_allow_html=True)

# Amadeus Flight Simulation (Real API ready)
def find_flights(origin, dest, outbound, return_date, adults=1):
    """Amadeus/Google Flights simulation"""
    flights = [
        {"airline": "Ryanair", "time": "SOF 07:00 ‚Üí AMS 09:30", "price": 72, "link": "https://ryanair.com"},
        {"airline": "Wizz Air", "time": "SOF 06:15 ‚Üí AMS 08:45", "price": 89, "link": "https://wizzair.com"},
    ]
    return pd.DataFrame(flights)

# Google Hotels Simulation (Real SerpAPI ready)
def find_hotels(dest, checkin, checkout, adults=1):
    """Google Hotels simulation"""
    hotels = [
        {"name": "Pulitzer Amsterdam ‚≠ê4.8", "price": 285, "link": "https://pulitzeramsterdam.com"},
        {"name": "Conservatorium ‚≠ê4.9", "price": 412, "link": "https://conservatoriumhotel.com"},
    ]
    return pd.DataFrame(hotels)

# AYA TravelBook PDF [file:65]
def create_aya_pdf(name, dest, flights, hotels, total):
    pdf = FPDF()
    pdf.add_page()
    pdf.set_fill_color(0, 180, 219)
    pdf.rect(0, 0, 210, 40, 'F')
    pdf.set_font('Arial', 'B', 24)
    pdf.set_text_color(255, 255, 255)
    pdf.cell(0, 20, 'AYA AI TRAVEL BOOK V4', 0, 1, 'C')
    
    pdf.ln(20)
    pdf.set_font('Arial', 'B', 16)
    pdf.set_text_color(0, 131, 176)
    pdf.cell(0, 10, f'–ü–™–¢U–í–ê–ù–ï: {dest.upper()}', 0, 1, 'C')
    pdf.cell(0, 10, f'–ö–õ–ò–ï–ù–¢: {name}', 0, 1, 'C')
    
    pdf.ln(10)
    pdf.set_font('Arial', '', 12)
    pdf.cell(0, 10, f'–ü–æ–ª–µ—Ç–∏: {flights["airline"].iloc[0]} | ‚Ç¨{flights["price"].iloc[0]}', 0, 1)
    pdf.cell(0, 10, f'–•–æ—Ç–µ–ª: {hotels["name"].iloc[0]} | ‚Ç¨{hotels["price"].iloc[0]}/–Ω–æ—â', 0, 1)
    pdf.cell(0, 10, f'–û–ë–©–û: ‚Ç¨{total}', 0, 1, 'C')
    
    pdf.ln(20)
    pdf.set_font('Arial', 'B', 14)
    pdf.cell(0, 10, f'–ö–æ–Ω—Å—É–ª—Ç–∞–Ω—Ç: {CONTACT_NAME}', 0, 1, 'C')
    pdf.set_font('Arial', '', 10)
    pdf.cell(0, 10, f'WhatsApp: +359 894 84 28 82 | {EMAIL}', 0, 1, 'C')
    
    return pdf.output(dest='S').encode('latin-1')

# MAIN AYA UI
def main():
    apply_aya_style()
    
    # –ü–ï–¢–Ø Header [file:61]
    st.markdown("""
    <div style='text-align: center; padding: 3rem;'>
        <h1 style='font-size: 4rem; margin: 0;'>ü§ñ –ü–ï–¢–Ø</h1>
        <h2 style='font-size: 2rem; color: #f0f8ff;'>AYA AI Travel Studio</h2>
        <p style='font-size: 1.3rem; color: rgba(255,255,255,0.9);'>Amadeus + Stripe + –ë–∏–ª—è–Ω–∞</p>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown('<div class="aya-card">', unsafe_allow_html=True)
    
    # Input Form
    col1, col2, col3 = st.columns([2, 2, 2])
    with col1:
        origin = st.selectbox("–û—Ç", ["SOF", "VAR", "PLV", "GOZ"])
        dest = st.selectbox("–î–æ", ["AMS", "PAR", "LON", "ROM", "ATH"])
    with col2:
        outbound = st.date_input("–ò–∑–ª–∏—Ç–∞–Ω–µ", datetime(2026, 1, 5))
        return_date = st.date_input("–í—Ä—ä—â–∞–Ω–µ", datetime(2026, 1, 10))
    with col3:
        adults = st.slider("–í—ä–∑—Ä–∞—Å—Ç–Ω–∏", 1, 4, 2)
    
    if st.button("üöÄ –ù–ê–ú–ò–†–ò –ü–™–¢–£–í–ê–ù–ï", use_container_width=True):
        with st.spinner("ü§ñ –ú–ò–Ø + –ï–í–ê –∞–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç..."):
            
            # Amadeus Flights
            flights = find_flights(origin, dest, outbound, return_date, adults)
            
            # Google Hotels  
            hotels = find_hotels(dest, outbound, return_date, adults)
            
            # Calculate Total
            nights = (return_date - outbound).days
            total = (flights['price'].sum() * adults) + (hotels['price'].iloc[0] * nights * adults)
            
            st.markdown("### ‚úàÔ∏è –ü–æ–ª–µ—Ç–∏ (Amadeus API)")
            for _, flight in flights.iterrows():
                st.markdown(f"‚úàÔ∏è **{flight['airline']}** {flight['time']} | **‚Ç¨{flight['price']}** | [–ö–Ω–∏–∂–∏]({flight['link']})")
            
            st.markdown("### üè® –•–æ—Ç–µ–ª–∏ (Google Hotels)")
            for _, hotel in hotels.iterrows():
                st.markdown(f"üè® **{hotel['name']}** | **‚Ç¨{hotel['price']}/–Ω–æ—â** | [–°–∞–π—Ç]({hotel['link']})")
            
            st.markdown(f"### üí∞ **–û–±—â–∞ —Ü–µ–Ω–∞: ‚Ç¨{total:.0f}**")
            st.markdown("*–í–∫–ª—é—á–µ–Ω–æ: –ü–æ–ª–µ—Ç–∏ + –•–æ—Ç–µ–ª + –¢–∞–∫—Å–∏*")
            
            # Stripe Simulation (Real Stripe ready)
            col_pay, col_pdf = st.columns(2)
            with col_pay:
                if st.button("üí≥ –ü–õ–ê–¢–ò –°–ï–ô–ß–ê–°", use_container_width=True):
                    st.success("‚úÖ –ü–ª–∞—â–∞–Ω–µ—Ç–æ –µ —É—Å–ø–µ—à–Ω–æ! üéâ")
                    st.balloons()
                    # WhatsApp –ë–∏–ª—è–Ω–∞
                    wa_msg = urllib.parse.quote(f"üîî –ù–û–í –ö–õ–ò–ï–ù–¢! ‚Ç¨{total} {dest} {outbound}-{return_date}")
                    st.markdown(f'[üì≤ –ò–∑–≤–µ—Å—Ç–∏ –ë–∏–ª—è–Ω–∞](https://wa.me/{WHATSAPP_PHONE}?text={wa_msg})')
            
            with col_pdf:
                pdf_bytes = create_aya_pdf("–ö–ª–∏–µ–Ω—Ç", f"{origin}‚Üí{dest}", flights.iloc[0], hotels.iloc[0], total)
                b64_pdf = base64.b64encode(pdf_bytes).decode()
                st.markdown(f"""
                <a href="data:application/pdf;base64,{b64_pdf}" download="AYA_TravelBook_{dest}.pdf">
                    <button style="width:100%; background:#d4af37; color:black;">üìÑ –ò–∑—Ç–µ–≥–ª–∏ TravelBook</button>
                </a>
                """, unsafe_allow_html=True)
    
    st.markdown('</div>', unsafe_allow_html=True)
    
    # Footer
    st.markdown(f"""
    <div style='text-align: center; padding: 2rem; color: rgba(255,255,255,0.7);'>
        <p>üöÄ Powered by AYA Master System | {CONTACT_NAME} | +359 894 84 28 82</p>
    </div>
    """, unsafe_allow_html=True)

if __name__ == "__main__":
    main()
